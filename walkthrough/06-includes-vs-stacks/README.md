# 06 - Includes vs Stacks

Before the introduction of the `terragrunt.stack.hcl` file, the best way to achieve Don't Repeat Yourself (DRY) configuration in Terragrunt was to use the `include` block. This block allowed you to include the contents of another Terragrunt configuration file into the current one. This was useful for sharing common configurations across multiple Terragrunt configurations.

However, the `include` block has some limitations. Mainly, you can only include configurations stored on your local filesystem, and including configurations can tightly couple your Terragrunt configurations. This can make it difficult to incrementally adjust Terragrunt configurations.

One can describe three different patterns for managing Terragrunt configurations, based on how much code reuse and how much flexibility users want to achieve:

1. The "Not DRY" pattern - Where each Terragrunt configuration is its own self-contained unit, with no code reuse.
2. The "_envcommon" pattern - Where common partial unit configurations are defined in a separate `_envcommon` directory, and then included into each relevant Terragrunt unit using the `include` block.
3. The "Stacks" pattern - Where Terragrunt configurations are organized into stacks, and common unit configurations are defined separately, and then generated by each relevant `terragrunt.hcl` file.

## Pattern Comparison

The following table is a summary of the key differences between the Not DRY, _envcommon, and Stacks patterns.

### Not DRY Pattern

**Pros:**

- Simple to understand and implement
- Maximum flexibility (each unit can be configured independently)
- Good for learning Terragrunt basics
- Easy to make incremental changes

**Cons:**

- High code duplication
- Difficult to maintain at scale
- Changes require updates to multiple files
- Error-prone when replicating configurations

### _envcommon Pattern

**Pros:**

- Reduces code duplication
- Single source of truth for common configurations
- Well-established pattern with community support
- Works well with existing tooling

**Cons:**

- Complex merge behavior between files
- Tight coupling between configurations
- Limited to local filesystem
- High file count
- Difficult to make incremental changes
- Complex environment-specific logic

### Stacks Pattern

**Pros:**

- Reduced file count
- Clear separation of unit and stack configurations
- Supports remote sources
- Easy environment-specific configurations
- Simpler to reason about final configurations
- Flexible rollout of changes
- Better scalability

**Cons:**

- Newer pattern with less community experience
- Requires different mental model
- May require retooling existing CI/CD
- Experimental support currently

## Summary Comparison Table

| Aspect | Not DRY | _envcommon | Stacks |
|--------|---------|------------|---------|
| Code Reuse | Low | High | High |
| Flexibility | High | Medium | High |
| Maintainability | Low | Medium | High |
| File Count | High | High | Low |
| Learning Curve | Low | Medium | Medium |
| Scalability | Low | Medium | High |
| Incremental Changes | Easy | Difficult | Easy |
| Remote Sources | N/A | No | Yes |
| Community Experience | High | High | Low |

Choose the pattern that best fits your team's needs and scale. The Stacks pattern is recommended for most teams starting new projects or looking to scale, but existing implementations using other patterns can still be effective if they're working well for your team.

## Walkthrough

For a more detailed walkthrough of the patterns, see the [Not DRY](../01-not-dry), [_envcommon](../02-envcommon), [Stacks](../03-stacks), and [Combining Patterns](../04-combining-patterns) walkthroughs.
